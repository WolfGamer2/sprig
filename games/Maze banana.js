/*
@title: Maze Banana
@author: Rushi Chopra
@tags: [maze, bananas]
@addedOn: 2024-06-28
*/

const player = "p";
const wall = "w";
const exit = "e";
const danger = "d";

setLegend(
  [ player, bitmap`
................
................
.......000......
.......0.0......
......0..0......
......0...0.0...
....0003.30.0...
....0.0...000...
....0.05550.....
......0...0.....
.....0....0.....
.....0...0......
......000.......
......0.0.......
.....00.00......
................` ],
  [ wall, bitmap`
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111` ],
  [ exit, bitmap`
................
................
................
....LLLLLL......
....L...........
....LLLLLL......
.........L......
.........L......
.........L......
.........L......
.....LLLLLL.....
.....L..........
.....L..........
.....LLLLLL.....
................
................` ],
  [ danger, bitmap`
................
................
................
................
......33333.....
......3...3.....
......3...3.....
......3...3.....
......33333.....
......3.........
......3.........
......3.........
......3.........
......3.........
......3.........
................` ]
);

setSolids([wall]);

let level = 0;
const levels = [
  map`
p.w
.w.
..e`,
  map`
p..w.
wwww.
....e
.wwww
.....`,
  map`
p.w..
w.w.e
.w...
..w..
....w`,
  map`
p..w..d
wwwwd.e
.....d.
.dwwww.
.......
.....w.`,
  map`
p.w.d.e
w.w.w..
w.d.w.w
.w.w.w.
...d...
d.w.w.w
.w.w.wd`
];

setMap(levels[level]);

setPushables({
  [player]: []
});

onInput("w", () => {
  getFirst(player).y -= 1;
});

onInput("a", () => {
  getFirst(player).x -= 1;
});

onInput("s", () => {
  getFirst(player).y += 1;
});

onInput("d", () => {
  getFirst(player).x += 1;
});

afterInput(() => {
  const playerPos = getFirst(player);
  const exitPos = getFirst(exit);
  const dangerTiles = tilesWith(danger);

  if (playerPos.x === exitPos.x && playerPos.y === exitPos.y) {
    level += 1;
    if (level < levels.length) {
      setMap(levels[level]);
    } else {
      addText("You win!", { y: 4, color: color`3` });
    }
  } else if (dangerTiles.some(tile => tile.x === playerPos.x && tile.y === playerPos.y)) {
    setMap(levels[level]);
  }
});
